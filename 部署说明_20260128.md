# ä¸­ä¿¡é“¶è¡Œå›½å¯†APIéƒ¨ç½²æ€»ç»“

**éƒ¨ç½²æ—¥æœŸ**: 2026å¹´1æœˆ28æ—¥  
**éƒ¨ç½²äºº**: GitHub Copilot  
**ç‰ˆæœ¬**: v1.1 (æ”¯æŒå¤šå­—æ®µåå’Œå¤šæ ¼å¼å¯†é’¥)

---

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

æˆåŠŸå°†**ä¸­ä¿¡é“¶è¡Œå›½å¯†åŠ è§£å¯†API**éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨ `tx.qsgl.net`ï¼Œå¹¶é€šè¿‡ Traefik åå‘ä»£ç†æä¾› HTTPS æœåŠ¡ã€‚

### å…³é”®ç‰¹æ€§

âœ… **SM2 éå¯¹ç§°åŠ å¯†/è§£å¯†/ç­¾å/éªŒç­¾**  
âœ… **SM3WithSM2 ç­¾åç®—æ³•**  
âœ… **SM4-CBC å¯¹ç§°åŠ å¯†/è§£å¯†**  
âœ… **å¤šå­—æ®µåå…¼å®¹**: æ”¯æŒ `plaintext`/`data`, `privateKey`/`privateKeyHex`, `publicKey`/`publicKeyHex`  
âœ… **å¤šæ ¼å¼å¯†é’¥**: æ”¯æŒ PEMã€Base64ã€Hex ä¸‰ç§å¯†é’¥æ ¼å¼  
âœ… **H5 æµ‹è¯•å·¥å…·**: æä¾›å¯è§†åŒ–æµ‹è¯•é¡µé¢  
âœ… **Swagger æ–‡æ¡£**: å®Œæ•´çš„ API æ–‡æ¡£  

---

## ğŸŒ è®¿é—®åœ°å€

| èµ„æº | URL | è¯´æ˜ |
|------|-----|------|
| **æµ‹è¯•å·¥å…·** | https://citic.qsgl.net/test.html | H5 å¯è§†åŒ–æµ‹è¯•é¡µé¢ |
| **APIæ–‡æ¡£** | https://citic.qsgl.net/swagger | Swagger UI |
| **APIåŸºç¡€URL** | https://citic.qsgl.net/api/Crypto | RESTful APIç«¯ç‚¹ |

---

## ğŸ”§ éƒ¨ç½²æ¶æ„

### å®¹å™¨é…ç½®

```yaml
å®¹å™¨åç§°: citic-gm-api
é•œåƒ: citic-gm-api-citic-gm-api:latest
ç½‘ç»œ: traefik-net (å¤–éƒ¨ç½‘ç»œ)
ç«¯å£: 8080 (å®¹å™¨å†…éƒ¨ï¼Œæ— å®¿ä¸»æœºæ˜ å°„)
æ ‡ç­¾: citic (Traefik è·¯ç”±æ ‡è¯†)
```

### é‡è¦è®¾è®¡åŸåˆ™

ğŸ”¹ **æ— å®¿ä¸»æœºç«¯å£æ˜ å°„**: å®¹å™¨ä»…é€šè¿‡ `traefik-net` Docker ç½‘ç»œé€šä¿¡  
ğŸ”¹ **Traefik è‡ªåŠ¨å‘ç°**: é€šè¿‡ Docker æ ‡ç­¾è‡ªåŠ¨é…ç½®è·¯ç”±å’Œ HTTPS  
ğŸ”¹ **é›¶åœæœºéƒ¨ç½²**: ä½¿ç”¨ `docker-compose up --build -d` æ›´æ–°ï¼Œä¸å½±å“ Traefik  
ğŸ”¹ **ç”Ÿäº§éš”ç¦»**: ä¸å½±å“åŒæœåŠ¡å™¨çš„ `dbaccess-api`ã€`wechat-api` ç­‰ç”Ÿäº§å®¹å™¨  

### docker-compose.yml å…³é”®é…ç½®

```yaml
services:
  citic-gm-api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: citic-gm-api
    restart: unless-stopped
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:8080
      - TZ=Asia/Shanghai
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.citic.rule=Host(`citic.qsgl.net`)"
      - "traefik.http.routers.citic.entrypoints=websecure"
      - "traefik.http.routers.citic.tls=true"
      - "traefik.http.routers.citic.tls.certresolver=letsencrypt"
      - "traefik.http.services.citic.loadbalancer.server.port=8080"
      - "traefik.http.routers.citic-http.rule=Host(`citic.qsgl.net`)"
      - "traefik.http.routers.citic-http.entrypoints=web"
      - "traefik.http.middlewares.citic-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.citic-http.middlewares=citic-https-redirect"
    networks:
      - traefik-net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/api/Crypto/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  traefik-net:
    external: true
```

---

## ğŸš€ API ä½¿ç”¨ç¤ºä¾‹

### 1. SM2 ç­¾åï¼ˆæ”¯æŒå¤šæ ¼å¼ç§é’¥ï¼‰

#### ä½¿ç”¨ PEM æ ¼å¼ç§é’¥
```bash
curl -X POST https://citic.qsgl.net/api/Crypto/sm2/sign \
  -H "Content-Type: application/json" \
  -d '{
    "plaintext": "æµ‹è¯•æ•°æ®",
    "privateKey": "-----BEGIN PRIVATE KEY-----\nMIGTAgEA...\n-----END PRIVATE KEY-----"
  }'
```

#### ä½¿ç”¨ Base64 æ ¼å¼ç§é’¥
```bash
curl -X POST https://citic.qsgl.net/api/Crypto/sm2/sign \
  -H "Content-Type: application/json" \
  -d '{
    "plaintext": "æµ‹è¯•æ•°æ®",
    "privateKey": "xB4ZLi0GN88d/LjX/FCyLc1FcQbLuRJo19YkXJLBP1I="
  }'
```

#### ä½¿ç”¨ Hex æ ¼å¼ç§é’¥
```bash
curl -X POST https://citic.qsgl.net/api/Crypto/sm2/sign \
  -H "Content-Type: application/json" \
  -d '{
    "plaintext": "æµ‹è¯•æ•°æ®",
    "privateKey": "c41e192e2d0637cf1dfcb8d7fc50b22dcd457106cbb91268d7d6245c92c13f52"
  }'
```

### 2. SM2 åŠ å¯†

```bash
curl -X POST https://citic.qsgl.net/api/Crypto/sm2/encrypt \
  -H "Content-Type: application/json" \
  -d '{
    "plaintext": "Hello World",
    "publicKey": "MIIBMzCB7AYHKoZIzj0CATCB4AIBATAsBgcqhkjOPQEBAiEA/////v////8AAAAA//////////+85vqtpxeehPO5ysL8YyVRAgEgBCBrF5cMhNFANd9HKJpwKZJxrv1Sz42pBZnHPKDp+GW6PQQhAqCJZJJmZJGZJLp0pSKSmpqVIlUqVRpVCkVRpUqVQoEoBCBR9mZmSqmZJJmZJJJmZJJJqZJJJJJJJJJJJJJJJJJJJIQiBHZ2ZqaqZJJJJJJJJJJJJqZJJJJJJJJJJJJJJJJJJJkCIQD////+/////wAAAAAAAAAAAP+85vqtpxeehPO5ysL8YyURAiBDZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXp7fH1+fwIBDQ==",
    "isBase64Input": false
  }'
```

### 3. SM2 è§£å¯†

```bash
curl -X POST https://citic.qsgl.net/api/Crypto/sm2/decrypt \
  -H "Content-Type: application/json" \
  -d '{
    "ciphertext": "MHgCIC/8MI262L0QPzD2m8gxhOF...",
    "privateKey": "xB4ZLi0GN88d/LjX/FCyLc1FcQbLuRJo19YkXJLBP1I="
  }'
```

### 4. SM4 åŠ å¯†

```bash
curl -X POST https://citic.qsgl.net/api/Crypto/sm4/encrypt \
  -H "Content-Type: application/json" \
  -d '{
    "plaintext": "æµ‹è¯•SM4åŠ å¯†",
    "key": "0123456789abcdef0123456789abcdef",
    "iv": "0123456789abcdef0123456789abcdef"
  }'
```

### 5. SM4 è§£å¯†

```bash
curl -X POST https://citic.qsgl.net/api/Crypto/sm4/decrypt \
  -H "Content-Type: application/json" \
  -d '{
    "ciphertext": "Base64ç¼–ç çš„å¯†æ–‡",
    "key": "0123456789abcdef0123456789abcdef",
    "iv": "0123456789abcdef0123456789abcdef"
  }'
```

### 6. ç”Ÿæˆ SM2 å¯†é’¥å¯¹

```bash
curl -X GET https://citic.qsgl.net/api/Crypto/sm2/keypair
```

### 7. ç”Ÿæˆ SM4 å¯†é’¥

```bash
curl -X GET https://citic.qsgl.net/api/Crypto/sm4/generate-key
```

---

## ğŸ”„ æ›´æ–°å’Œç»´æŠ¤

### éƒ¨ç½²æ›´æ–°æ­¥éª¤

1. **æœ¬åœ°ç¼–è¯‘å‘å¸ƒ**
   ```powershell
   cd K:\payment\citic\.Net\CiticGmApi
   dotnet publish -c Release -o ./publish --self-contained true -r linux-x64
   ```

2. **æ‰“åŒ…**
   ```powershell
   cd publish
   tar -czf ../citic-gm-api-update.tar.gz *
   ```

3. **ä¸Šä¼ åˆ°æœåŠ¡å™¨**
   ```powershell
   scp -i "K:\Key\tx.qsgl.net_id_ed25519" citic-gm-api-update.tar.gz root@tx.qsgl.net:/tmp/
   ```

4. **éƒ¨ç½²ï¼ˆä¸å½±å“ Traefikï¼‰**
   ```bash
   cd /opt/citic-gm-api
   docker-compose down
   rm -rf *
   tar -xzf /tmp/citic-gm-api-update.tar.gz
   chmod +x CiticGmApi
   docker-compose up --build -d
   ```

### æŸ¥çœ‹å®¹å™¨çŠ¶æ€

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps --filter name=citic

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs citic-gm-api

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker logs -f citic-gm-api

# æ£€æŸ¥å¥åº·çŠ¶æ€
docker inspect citic-gm-api | jq '.[0].State.Health'
```

### éªŒè¯éƒ¨ç½²

```bash
# æµ‹è¯• API
curl https://citic.qsgl.net/api/Crypto/sm2/keypair

# è®¿é—® Swagger
curl https://citic.qsgl.net/swagger/v1/swagger.json

# è®¿é—®æµ‹è¯•é¡µé¢
curl https://citic.qsgl.net/test.html
```

---

## ğŸ“Š æµ‹è¯•ç»“æœ

### åŠŸèƒ½æµ‹è¯•ï¼ˆ2026-01-28ï¼‰

| æµ‹è¯•é¡¹ | ç»“æœ | è¯´æ˜ |
|--------|------|------|
| H5 æµ‹è¯•é¡µé¢è®¿é—® | âœ… é€šè¿‡ | https://citic.qsgl.net/test.html |
| Swagger æ–‡æ¡£è®¿é—® | âœ… é€šè¿‡ | https://citic.qsgl.net/swagger |
| SM2 ç­¾å (PEMç§é’¥) | âœ… é€šè¿‡ | æ”¯æŒ plaintext å­—æ®µ |
| SM2 ç­¾å (Base64ç§é’¥) | âœ… é€šè¿‡ | è‡ªåŠ¨è¯†åˆ«æ ¼å¼ |
| SM2 ç­¾å (Hexç§é’¥) | âœ… é€šè¿‡ | 64å­—ç¬¦Hexå­—ç¬¦ä¸² |
| å®¹å™¨ç½‘ç»œéš”ç¦» | âœ… é€šè¿‡ | æ— å®¿ä¸»æœºç«¯å£æ˜ å°„ |
| Traefik è‡ªåŠ¨å‘ç° | âœ… é€šè¿‡ | é€šè¿‡æ ‡ç­¾é…ç½®è·¯ç”± |
| HTTPS è‡ªåŠ¨è·³è½¬ | âœ… é€šè¿‡ | HTTPè‡ªåŠ¨é‡å®šå‘åˆ°HTTPS |
| å¥åº·æ£€æŸ¥ | âœ… é€šè¿‡ | 30ç§’é—´éš”æ£€æŸ¥ |
| DBAccess å®¹å™¨éš”ç¦» | âœ… é€šè¿‡ | æœªå—å½±å“ |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸è¦é‡å¯ Traefik å®¹å™¨**  
   æ‰€æœ‰æ›´æ–°é€šè¿‡ `docker-compose` å®Œæˆï¼ŒTraefik ä¼šè‡ªåŠ¨æ„ŸçŸ¥å®¹å™¨å˜åŒ–ã€‚

2. **ä¸è¦æ˜ å°„å®¿ä¸»æœºç«¯å£**  
   citic-gm-api å®¹å™¨åªé€šè¿‡ `traefik-net` ç½‘ç»œé€šä¿¡ï¼Œä¸éœ€è¦ç«¯å£æ˜ å°„ã€‚

3. **ä¿æŒç½‘ç»œé…ç½®ä¸€è‡´**  
   æ‰€æœ‰åº”ç”¨å®¹å™¨å’Œ Traefik éƒ½åŠ å…¥ `traefik-net` å¤–éƒ¨ç½‘ç»œã€‚

4. **ä½¿ç”¨ citic æ ‡ç­¾**  
   Traefik è·¯ç”±å™¨åç§°ç»Ÿä¸€ä½¿ç”¨ `citic`ï¼Œé¿å…å†²çªã€‚

5. **å¤‡ä»½é‡è¦æ•°æ®**  
   æ›´æ–°å‰å»ºè®®å¤‡ä»½å½“å‰è¿è¡Œçš„å®¹å™¨é•œåƒï¼š
   ```bash
   docker commit citic-gm-api citic-gm-api:backup-$(date +%Y%m%d-%H%M%S)
   ```

---

## ğŸ“ ç‰ˆæœ¬å†å²

### v1.1 (2026-01-28)
- âœ¨ æ–°å¢å¤šå­—æ®µåæ”¯æŒ (`plaintext`/`data`, `privateKey`/`privateKeyHex`)
- âœ¨ æ–°å¢å¤šæ ¼å¼å¯†é’¥æ”¯æŒ (PEM/Base64/Hex)
- âœ¨ æ–°å¢ H5 å¯è§†åŒ–æµ‹è¯•å·¥å…·
- âœ¨ ä¼˜åŒ– Swagger è·¯ç”±åˆ° `/swagger`
- âœ¨ æ ¹è·¯å¾„è‡ªåŠ¨é‡å®šå‘åˆ°æµ‹è¯•å·¥å…·
- ğŸ› ä¿®å¤ä¸ DBAccess å®¹å™¨çš„ç«¯å£å†²çªé—®é¢˜
- ğŸ”§ ä¼˜åŒ–å®¹å™¨ç½‘ç»œé…ç½®ï¼ˆä»…ä½¿ç”¨ traefik-netï¼‰

### v1.0 (2026-01-21)
- ğŸ‰ åˆå§‹éƒ¨ç½²
- âœ… SM2/SM3/SM4 åŠ å¯†åŠŸèƒ½
- âœ… Docker + Traefik éƒ¨ç½²
- âœ… HTTPS æ”¯æŒ

---

## ğŸ”— ç›¸å…³é“¾æ¥

- **GitHub ä»“åº“**: https://github.com/qsswgl/CiticGmApi
- **æœåŠ¡å™¨**: tx.qsgl.net (43.138.35.183)
- **åŸŸå**: citic.qsgl.net
- **Traefik ç‰ˆæœ¬**: v3.2
- **.NET ç‰ˆæœ¬**: 10.0
- **BouncyCastle**: 2.5.0

---

## ğŸ‘¨â€ğŸ’» æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. å®¹å™¨æ—¥å¿—: `docker logs citic-gm-api`
2. ç½‘ç»œé…ç½®: `docker network inspect traefik-net`
3. Traefik è·¯ç”±: è®¿é—® Traefik Dashboard
4. API æ–‡æ¡£: https://citic.qsgl.net/swagger

---

**éƒ¨ç½²å®Œæˆï¼** âœ¨
