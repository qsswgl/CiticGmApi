# æœ¬åœ°æž„å»ºä¸Žè¿œç¨‹éƒ¨ç½²æ–¹æ¡ˆæ€»ç»“

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. åˆ›å»ºæœ¬åœ°éƒ¨ç½²è„šæœ¬
**æ–‡ä»¶**: `build-and-deploy.ps1`

ä¸€é”®è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
- âœ… éªŒè¯çŽ¯å¢ƒå’Œå¿…è¦æ¡ä»¶
- âœ… æœ¬åœ°æž„å»º Docker é•œåƒï¼ˆ.NET 10 Native AOTï¼‰
- âœ… å¯¼å‡ºé•œåƒä¸º TAR.GZ æ–‡ä»¶
- âœ… é€šè¿‡ SCP ä¸Šä¼ åˆ°è…¾è®¯äº‘æœåŠ¡å™¨
- âœ… è¿œç¨‹æ‰§è¡Œéƒ¨ç½²è„šæœ¬
- âœ… éªŒè¯å¥åº·æ£€æŸ¥
- âœ… æ¸…ç†ä¸´æ—¶æ–‡ä»¶

**è¿è¡Œæ–¹å¼**:
```powershell
cd K:\payment\AbcPaymentGateway
.\build-and-deploy.ps1
```

### 2. åˆ›å»ºçŽ¯å¢ƒæ£€æŸ¥è„šæœ¬
**æ–‡ä»¶**: `check-deploy-env.ps1`

éªŒè¯éƒ¨ç½²å‰çš„çŽ¯å¢ƒå‡†å¤‡ï¼š
- âœ… Docker å¯ç”¨æ€§
- âœ… SSH ç§é’¥å­˜åœ¨
- âœ… Git å¯ç”¨
- âœ… é¡¹ç›®æ–‡ä»¶å®Œæ•´
- âœ… ç½‘ç»œè¿žæŽ¥
- âœ… SSH è®¤è¯æˆåŠŸ

**è¿è¡Œæ–¹å¼**:
```powershell
.\check-deploy-env.ps1
```

**é¢„æœŸç»“æžœ**: `Results: 7/7 passed` âœ…

### 3. ç®€åŒ– GitHub Actions å·¥ä½œæµ
**æ–‡ä»¶**: `.github/workflows/auto-deploy.yml`

æ”¹ä¸º**é€šçŸ¥åž‹**å·¥ä½œæµï¼š
- âŒ ä¸å†æ‰§è¡Œ SSH éƒ¨ç½²ï¼ˆé¿å… GitHub Actions SSH è®¤è¯é—®é¢˜ï¼‰
- âœ… æŽ¨é€ä»£ç æ—¶è‡ªåŠ¨è§¦å‘
- âœ… æ˜¾ç¤ºéƒ¨ç½²è¯´æ˜Žå’Œä¸‹ä¸€æ­¥æ“ä½œ

### 4. å®Œæ•´çš„éƒ¨ç½²æ–‡æ¡£
**æ–‡ä»¶**: `LOCAL_DEPLOY.md`

åŒ…å«ï¼š
- å·¥ä½œæµç¨‹å›¾
- è¯¦ç»†çš„éƒ¨ç½²æ­¥éª¤
- å‚æ•°è¯´æ˜Ž
- é”™è¯¯æŽ’æŸ¥æŒ‡å—
- éƒ¨ç½²éªŒè¯æ–¹æ³•

### 5. å¿«é€Ÿå¼€å§‹æŒ‡å—
**æ–‡ä»¶**: `QUICKSTART.md`

ç®€æ´çš„å…¥é—¨æŒ‡å—ï¼š
- æ¦‚è§ˆå’Œå‰ç½®æ¡ä»¶
- ä¸€é”®éƒ¨ç½²æ­¥éª¤
- éªŒè¯æ–¹æ³•
- é«˜çº§ç”¨æ³•ç¤ºä¾‹

## ðŸ”„ å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœ¬åœ°å¼€å‘                                 â”‚
â”‚ git push origin master                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GitHub Actions é€šçŸ¥                      â”‚
â”‚ æ˜¾ç¤ºéƒ¨ç½²è¯´æ˜Ž (ä¸æ‰§è¡Œéƒ¨ç½²)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœ¬åœ°æ‰§è¡Œéƒ¨ç½²è„šæœ¬                         â”‚
â”‚ .\build-and-deploy.ps1                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼          â–¼          â–¼
 æž„å»ºé•œåƒ   æ‰“åŒ….tar   SCPä¸Šä¼ 
    â”‚          â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿œç¨‹æœåŠ¡å™¨ (tx.qsgl.net)                â”‚
â”‚ - åŠ è½½é•œåƒ                               â”‚
â”‚ - docker-compose down                   â”‚
â”‚ - docker-compose up -d                  â”‚
â”‚ - å¥åº·æ£€æŸ¥                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
        âœ… éƒ¨ç½²å®Œæˆ
    https://payment.qsgl.net
```

## ðŸŽ¯ å…³é”®ä¼˜åŠ¿

| æ–¹é¢ | GitHub Actions è‡ªåŠ¨éƒ¨ç½² | æœ¬åœ°éƒ¨ç½²æ–¹æ¡ˆ |
|------|------------------------|-----------|
| **SSH è®¤è¯** | âŒ åå¤å¤±è´¥ | âœ… æœ¬åœ° SSH å¯†é’¥ |
| **æž„å»ºä½ç½®** | GitHub äº‘çŽ¯å¢ƒ | âœ… æœ¬åœ°æœºå™¨ |
| **ç½‘ç»œå»¶è¿Ÿ** | éœ€è¦åŒå‘é€šä¿¡ | âœ… å•å‘ä¸Šä¼  |
| **è°ƒè¯•éš¾åº¦** | ðŸ“ Actions æ—¥å¿— | âœ… æœ¬åœ°å¯è§ |
| **éƒ¨ç½²é€Ÿåº¦** | 6-8 åˆ†é’Ÿ | âœ… 4-6 åˆ†é’Ÿ |
| **ä¾èµ–** | GitHub Secrets | âœ… æœ¬åœ° SSH å¯†é’¥ |
| **å¯é æ€§** | ä¸­ç­‰ | âœ… é«˜ |

## ðŸ“Š éƒ¨ç½²æ€§èƒ½

**æ€»è€—æ—¶**: çº¦ 4-8 åˆ†é’Ÿï¼ˆå–å†³äºŽç½‘ç»œé€Ÿåº¦ï¼‰

| æ­¥éª¤ | æ—¶é—´ | è¯¦æƒ… |
|------|------|------|
| [1] æ£€æŸ¥çŽ¯å¢ƒ | ~30ç§’ | éªŒè¯ Dockerã€SSH ç­‰ |
| [2] æž„å»ºé•œåƒ | 3-5åˆ†é’Ÿ | é¦–æ¬¡æ›´é•¿ï¼Œä¹‹åŽæœ‰ç¼“å­˜ |
| [3] å¯¼å‡ºé•œåƒ | 30-60ç§’ | åŽ‹ç¼© 100-200MB é•œåƒ |
| [4] ä¸Šä¼ æ–‡ä»¶ | 1-3åˆ†é’Ÿ | å–å†³äºŽç½‘é€Ÿï¼ˆæ·±åœ³å¯èƒ½ 30-60ç§’ï¼‰ |
| [5] è¿œç¨‹éƒ¨ç½² | 30-60ç§’ | åŠ è½½é•œåƒã€å¯åŠ¨ã€å¥åº·æ£€æŸ¥ |
| **æ€»è®¡** | **4-8åˆ†é’Ÿ** | å¤§éƒ¨åˆ†æ—¶é—´ç”¨åœ¨æž„å»ºä¸Š |

## ðŸ” å®‰å…¨æ€§

âœ… **ä¸åœ¨ GitHub å­˜å‚¨æ•æ„Ÿä¿¡æ¯**
- SSH ç§é’¥åªåœ¨æœ¬åœ°ä½¿ç”¨
- æ— éœ€é…ç½® GitHub Secrets
- æ— éœ€åœ¨ä»“åº“ä¸­æš´éœ²å¯†é’¥

âœ… **ä½¿ç”¨æ ‡å‡† SSH åè®®**
- åŠ å¯†çš„ SSH é€šä¿¡
- å¯†é’¥è®¤è¯ï¼ˆä¸æ˜¯å¯†ç ï¼‰
- å®‰å…¨çš„ SCP æ–‡ä»¶ä¼ è¾“

âœ… **ç”Ÿäº§çº§åˆ«çš„éƒ¨ç½²æ–¹æ¡ˆ**
- å¯å®¡è®¡çš„è„šæœ¬
- å®Œæ•´çš„é”™è¯¯å¤„ç†
- å¥åº·æ£€æŸ¥éªŒè¯

## ðŸ“‹ éƒ¨ç½²æ¸…å•

åœ¨è¿è¡Œéƒ¨ç½²å‰ï¼Œç¡®ä¿ï¼š

- [ ] ä»£ç å·² git push åˆ° master åˆ†æ”¯
- [ ] æœ¬åœ°æœ‰å¯ç”¨çš„ SSH ç§é’¥ (`K:\Key\tx.qsgl.net_id_ed25519`)
- [ ] Docker Desktop å·²å¯åŠ¨
- [ ] ç½‘ç»œè¿žæŽ¥æ­£å¸¸ï¼ˆå¯ä»¥ ping tx.qsgl.netï¼‰
- [ ] è¿œç¨‹æœåŠ¡å™¨çš„ `/opt/payment-gateway` ç›®å½•å­˜åœ¨
- [ ] è¿œç¨‹æœåŠ¡å™¨ä¸Šå·²å®‰è£… Docker & Docker Compose

## ðŸš€ éƒ¨ç½²å‘½ä»¤

### å¿«é€Ÿéƒ¨ç½²ï¼ˆæŽ¨èï¼‰
```powershell
cd K:\payment\AbcPaymentGateway
.\build-and-deploy.ps1
```

### éªŒè¯çŽ¯å¢ƒï¼ˆå¯é€‰ï¼‰
```powershell
.\check-deploy-env.ps1
```

### æ‰‹åŠ¨éƒ¨ç½²ï¼ˆé«˜çº§ï¼‰
```powershell
# 1. æž„å»ºé•œåƒ
docker build -t payment-gateway-jit:latest .

# 2. å¯¼å‡ºé•œåƒ
docker save payment-gateway-jit:latest | gzip > image.tar.gz

# 3. ä¸Šä¼ 
scp -i "K:\Key\tx.qsgl.net_id_ed25519" image.tar.gz root@tx.qsgl.net:/tmp/

# 4. è¿œç¨‹éƒ¨ç½²
ssh -i "K:\Key\tx.qsgl.net_id_ed25519" root@tx.qsgl.net "cd /opt/payment-gateway && docker load < /tmp/image.tar.gz && docker-compose up -d"
```

## ðŸ“š æ–‡æ¡£å¯¼èˆª

| æ–‡æ¡£ | ç”¨é€” |
|------|------|
| **QUICKSTART.md** | å¿«é€Ÿå¼€å§‹æŒ‡å—ï¼ˆæŽ¨èé¦–å…ˆé˜…è¯»ï¼‰ |
| **LOCAL_DEPLOY.md** | å®Œæ•´çš„éƒ¨ç½²æ–‡æ¡£å’Œæ•…éšœæŽ’æŸ¥ |
| **build-and-deploy.ps1** | éƒ¨ç½²è„šæœ¬æºä»£ç  |
| **check-deploy-env.ps1** | çŽ¯å¢ƒæ£€æŸ¥è„šæœ¬ |
| **.github/workflows/auto-deploy.yml** | GitHub Actions å·¥ä½œæµ |

## â“ å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆæ”¹ä¸ºæœ¬åœ°éƒ¨ç½²ï¼Ÿ**  
A: GitHub Actions ä¸­çš„ SSH è®¤è¯é‡åˆ°é—®é¢˜ï¼ˆlibcrypto é”™è¯¯ã€æƒé™é—®é¢˜ç­‰ï¼‰ï¼Œæ”¹ä¸ºæœ¬åœ°éƒ¨ç½²æ›´å¯é ä¸”æ›´å¿«ã€‚

**Q: æ¯æ¬¡éƒ½éœ€è¦æœ¬åœ°æž„å»ºå—ï¼Ÿ**  
A: æ˜¯çš„ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿é•œåƒæ€»æ˜¯æœ€æ–°çš„ä¸”é€‚é…æœ¬åœ°å¼€å‘ã€‚

**Q: å¯ä»¥å›žåˆ° GitHub Actions è‡ªåŠ¨éƒ¨ç½²å—ï¼Ÿ**  
A: å¯ä»¥ï¼Œä½†éœ€è¦è§£å†³ SSH è®¤è¯é—®é¢˜ã€‚å½“å‰æ–¹æ¡ˆæ›´ç®€å•å¯é ã€‚

**Q: éƒ¨ç½²å¤±è´¥äº†æ€Žä¹ˆåŠžï¼Ÿ**  
A: æŸ¥çœ‹ `LOCAL_DEPLOY.md` ä¸­çš„æ•…éšœæŽ’æŸ¥éƒ¨åˆ†ï¼Œæˆ–è¿è¡Œ `docker logs payment-gateway` æŸ¥çœ‹åº”ç”¨æ—¥å¿—ã€‚

**Q: å¯ä»¥éƒ¨ç½²åˆ°å…¶ä»–æœåŠ¡å™¨å—ï¼Ÿ**  
A: å¯ä»¥ï¼Œè¿è¡Œè„šæœ¬æ—¶ä½¿ç”¨è‡ªå®šä¹‰å‚æ•°ï¼š
```powershell
.\build-and-deploy.ps1 -RemoteHost "other-server.com" -RemoteUser "admin"
```

## ðŸ“ž æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜æ—¶ï¼š

1. è¿è¡ŒçŽ¯å¢ƒæ£€æŸ¥: `.\check-deploy-env.ps1`
2. æŸ¥çœ‹å®Œæ•´æ–‡æ¡£: `LOCAL_DEPLOY.md`
3. æ£€æŸ¥è„šæœ¬æ—¥å¿—è¾“å‡º
4. æ‰‹åŠ¨ SSH åˆ°æœåŠ¡å™¨è°ƒè¯•ï¼š
   ```powershell
   ssh -i "K:\Key\tx.qsgl.net_id_ed25519" root@tx.qsgl.net
   docker ps
   docker logs payment-gateway
   ```

---

**å®Œæˆæ—¥æœŸ**: 2026-01-12  
**ç‰ˆæœ¬**: 1.0  
**çŠ¶æ€**: âœ… å°±ç»ªå¯ç”¨
